!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/common/http"),require("@angular/material/list"),require("@angular/material/toolbar"),require("@angular/material/sidenav"),require("@angular/material/icon"),require("@angular/material/card"),require("@angular/material/button"),require("@angular/material/form-field"),require("@angular/material/input"),require("@angular/material/menu"),require("@angular/material/table"),require("@angular/material/snack-bar"),require("@t4d-wnow/shared-lib"),require("@angular/router"),require("rxjs"),require("rxjs/operators"),require("lodash-es")):"function"==typeof define&&define.amd?define("user-lib",["exports","@angular/common","@angular/core","@angular/forms","@angular/common/http","@angular/material/list","@angular/material/toolbar","@angular/material/sidenav","@angular/material/icon","@angular/material/card","@angular/material/button","@angular/material/form-field","@angular/material/input","@angular/material/menu","@angular/material/table","@angular/material/snack-bar","@t4d-wnow/shared-lib","@angular/router","rxjs","rxjs/operators","lodash-es"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["user-lib"]={},e.ng.common,e.ng.core,e.ng.forms,e.ng.common.http,e.ng.material.list,e.ng.material.toolbar,e.ng.material.sidenav,e.ng.material.icon,e.ng.material.card,e.ng.material.button,e.ng.material.formField,e.ng.material.input,e.ng.material.menu,e.ng.material.table,e.ng.material.snackBar,e["t4d-wnow-shared-lib"],e.ng.router,e.rxjs,e.rxjs.operators,e["lodash-es"])}(this,(function(e,t,n,r,o,a,i,l,s,u,m,c,d,p,f,g,h,v,M,w,y){"use strict";function b(e,t){1&e&&(n.ɵɵelementStart(0,"div",9),n.ɵɵelementStart(1,"mat-icon",10),n.ɵɵtext(2,"error"),n.ɵɵelementEnd(),n.ɵɵtext(3," The new password and the confirm password do not match. "),n.ɵɵelementEnd())}var S=function(){function e(e){this.fb=e,this.changePassword=new n.EventEmitter}return e.prototype.ngOnInit=function(){this.changePasswordForm=this.fb.group({currentPassword:"",newPassword:"",confirmPassword:""},{validators:[h.confirmValue("newPassword","confirmPassword")]})},e.prototype.doChangePassword=function(){this.changePasswordForm.valid&&this.changePassword.emit(this.changePasswordForm.value)},e}();S.ɵfac=function(e){return new(e||S)(n.ɵɵdirectiveInject(r.FormBuilder))},S.ɵcmp=n.ɵɵdefineComponent({type:S,selectors:[["app-change-password-form"]],outputs:{changePassword:"changePassword"},decls:20,vars:2,consts:[[1,"change-password-form",3,"formGroup"],["class","mat-error error",4,"ngIf"],[1,"form-field"],["appearance","outline"],["matInput","","type","password","formControlName","currentPassword"],["matInput","","type","password","formControlName","newPassword"],["matInput","","type","password","formControlName","confirmPassword"],[1,"buttons"],["type","button","mat-raised-button","","color","primary",3,"click"],[1,"mat-error","error"],["aria-hidden","false","aria-label","Error"]],template:function(e,t){1&e&&(n.ɵɵelementStart(0,"form",0),n.ɵɵtemplate(1,b,4,0,"div",1),n.ɵɵelementStart(2,"div",2),n.ɵɵelementStart(3,"mat-form-field",3),n.ɵɵelementStart(4,"mat-label"),n.ɵɵtext(5,"Current Password"),n.ɵɵelementEnd(),n.ɵɵelement(6,"input",4),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(7,"div",2),n.ɵɵelementStart(8,"mat-form-field",3),n.ɵɵelementStart(9,"mat-label"),n.ɵɵtext(10,"New Password"),n.ɵɵelementEnd(),n.ɵɵelement(11,"input",5),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(12,"div",2),n.ɵɵelementStart(13,"mat-form-field",3),n.ɵɵelementStart(14,"mat-label"),n.ɵɵtext(15,"Confirm Password"),n.ɵɵelementEnd(),n.ɵɵelement(16,"input",6),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(17,"div",7),n.ɵɵelementStart(18,"button",8),n.ɵɵlistener("click",(function(){return t.doChangePassword()})),n.ɵɵtext(19," Change Password "),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementEnd()),2&e&&(n.ɵɵproperty("formGroup",t.changePasswordForm),n.ɵɵadvance(1),n.ɵɵproperty("ngIf",null==t.changePasswordForm||null==t.changePasswordForm.errors?null:t.changePasswordForm.errors.confirmValue))},directives:[r.ɵangular_packages_forms_forms_y,r.NgControlStatusGroup,r.FormGroupDirective,t.NgIf,c.MatFormField,c.MatLabel,d.MatInput,r.DefaultValueAccessor,r.NgControlStatus,r.FormControlName,m.MatButton,s.MatIcon],styles:[".error[_ngcontent-%COMP%]{padding:10px;text-align:center}.error[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{vertical-align:middle}.buttons[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]{text-align:center}.buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin:4px}"]});var C=function(){function e(e,t,n){this.username=e,this.userKind=t,this.displayName=n,this.roles=[]}return e.prototype.addRole=function(e){if(!e)throw new Error("role name cannot be empty");return this.roles.push(e),this},e.prototype.hasRole=function(e){return y.intersection(this.roles,e).length>0},e}(),P=function(){function e(e){this.httpClient=e,this.accessToken=null,this.currentUser=null}return e.prototype.loginEmployee=function(e,t){var n=this;return this.httpClient.post("/api/users/login",{username:e,password:t,kind:"employee"}).pipe(w.tap((function(e){n.accessToken=e.accessToken,localStorage.refreshToken=e.refreshToken})),w.map((function(e){var t=new C(e.username,e.userKind,e.displayName);return e.roles.forEach((function(e){return t.addRole(e)})),t})),w.tap((function(e){n.currentUser=e})))},e.prototype.refreshUser=function(){var e=this;return this.httpClient.get("/api/users/refresh").pipe(w.tap((function(t){e.accessToken=t.accessToken,localStorage.refreshToken=t.refreshToken})),w.map((function(){return M.of(!0)})))},e.prototype.changePassword=function(e,t,n,r){return this.httpClient.post("/api/users/change-password",{username:e,userKind:t,oldPassword:n,newPassword:r})},e.prototype.getCurrentUser=function(){return this.currentUser},e.prototype.getAccessToken=function(){return this.accessToken},e.prototype.getRefreshToken=function(){return localStorage.refreshToken},e.prototype.logoutUser=function(){this.accessToken=null,this.currentUser=null,localStorage.refreshToken=null},e}();function E(e,t){if(1&e){var r=n.ɵɵgetCurrentView();n.ɵɵelementStart(0,"div"),n.ɵɵelementStart(1,"button",1),n.ɵɵelementStart(2,"mat-icon",2),n.ɵɵtext(3,"account_circle"),n.ɵɵelementEnd(),n.ɵɵelementStart(4,"span"),n.ɵɵtext(5),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(6,"mat-menu",null,3),n.ɵɵelementStart(8,"button",4),n.ɵɵlistener("click",(function(){return n.ɵɵrestoreView(r),n.ɵɵnextContext().navigateToProfile()})),n.ɵɵtext(9,"Profile"),n.ɵɵelementEnd(),n.ɵɵelementStart(10,"button",4),n.ɵɵlistener("click",(function(){return n.ɵɵrestoreView(r),n.ɵɵnextContext().navigateToLogout()})),n.ɵɵtext(11,"Logout"),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementEnd()}if(2&e){var o=n.ɵɵreference(7),a=n.ɵɵnextContext();n.ɵɵadvance(1),n.ɵɵproperty("matMenuTriggerFor",o),n.ɵɵadvance(4),n.ɵɵtextInterpolate2("",a.displayName," (",a.username,")")}}function x(e,t){if(1&e){var r=n.ɵɵgetCurrentView();n.ɵɵelementStart(0,"div"),n.ɵɵelementStart(1,"button",5),n.ɵɵlistener("click",(function(){return n.ɵɵrestoreView(r),n.ɵɵnextContext().navigateToLogin()})),n.ɵɵelementStart(2,"mat-icon",2),n.ɵɵtext(3,"account_circle"),n.ɵɵelementEnd(),n.ɵɵelementStart(4,"span"),n.ɵɵtext(5,"Login"),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementEnd()}}P.ɵfac=function(e){return new(e||P)(n.ɵɵinject(o.HttpClient))},P.ɵprov=n.ɵɵdefineInjectable({token:P,factory:P.ɵfac,providedIn:"root"});var I=function(){function e(e,t){this.router=e,this.usersSvc=t}return Object.defineProperty(e.prototype,"loggedIn",{get:function(){return!!this.usersSvc.getCurrentUser()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){var e,t;return null!==(t=null===(e=this.usersSvc.getCurrentUser())||void 0===e?void 0:e.displayName)&&void 0!==t?t:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"username",{get:function(){var e,t;return null!==(t=null===(e=this.usersSvc.getCurrentUser())||void 0===e?void 0:e.username)&&void 0!==t?t:""},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){},e.prototype.navigateToProfile=function(){return this.router.navigateByUrl("/profile")},e.prototype.navigateToLogout=function(){return this.router.navigateByUrl("/logout")},e.prototype.navigateToLogin=function(){return this.router.navigateByUrl("/login")},e}();function k(e,t){1&e&&(n.ɵɵelementStart(0,"mat-list-item",15),n.ɵɵelementStart(1,"mat-icon",16),n.ɵɵtext(2,"arrow_right"),n.ɵɵelementEnd(),n.ɵɵtext(3," Username is required. "),n.ɵɵelementEnd())}function F(e,t){1&e&&(n.ɵɵelementStart(0,"mat-list-item",15),n.ɵɵelementStart(1,"mat-icon",16),n.ɵɵtext(2,"arrow_right"),n.ɵɵelementEnd(),n.ɵɵtext(3," Password is required. "),n.ɵɵelementEnd())}function T(e,t){if(1&e&&(n.ɵɵelementStart(0,"mat-card",10),n.ɵɵelementStart(1,"mat-card-header",11),n.ɵɵelementStart(2,"mat-card-title",12),n.ɵɵtext(3," Errors "),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(4,"mat-card-content"),n.ɵɵelementStart(5,"mat-list",13),n.ɵɵtemplate(6,k,4,0,"mat-list-item",14),n.ɵɵtemplate(7,F,4,0,"mat-list-item",14),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementEnd()),2&e){var r=n.ɵɵnextContext();n.ɵɵadvance(6),n.ɵɵproperty("ngIf",r.showUsernameError),n.ɵɵadvance(1),n.ɵɵproperty("ngIf",r.showPasswordError)}}function _(e,t){1&e&&(n.ɵɵelementStart(0,"mat-error"),n.ɵɵtext(1,"Username is required"),n.ɵɵelementEnd())}function O(e,t){1&e&&(n.ɵɵelementStart(0,"mat-error"),n.ɵɵtext(1,"Password is required"),n.ɵɵelementEnd())}I.ɵfac=function(e){return new(e||I)(n.ɵɵdirectiveInject(v.Router),n.ɵɵdirectiveInject(P))},I.ɵcmp=n.ɵɵdefineComponent({type:I,selectors:[["app-current-user"]],decls:2,vars:2,consts:[[4,"ngIf"],["mat-button","",3,"matMenuTriggerFor"],["aria-hidden","false","aria-label","User Account"],["menu","matMenu"],["mat-menu-item","",3,"click"],["mat-button","",3,"click"]],template:function(e,t){1&e&&(n.ɵɵtemplate(0,E,12,3,"div",0),n.ɵɵtemplate(1,x,6,0,"div",0)),2&e&&(n.ɵɵproperty("ngIf",t.loggedIn),n.ɵɵadvance(1),n.ɵɵproperty("ngIf",!t.loggedIn))},directives:[t.NgIf,m.MatButton,p.MatMenuTrigger,s.MatIcon,p.MatMenu,p.MatMenuItem],styles:["mat-icon[_ngcontent-%COMP%]{margin-right:4px}"]});var j=function(){function e(e){this.fb=e,this.loginFormSubmitted=!1,this.login=new n.EventEmitter,this.clear=new n.EventEmitter}return Object.defineProperty(e.prototype,"showLoginFormValidationSummary",{get:function(){return this.loginForm.invalid&&this.loginFormSubmitted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showUsernameError",{get:function(){return this.loginForm.get("username").invalid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showPasswordError",{get:function(){return this.loginForm.get("password").invalid},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.loginForm=this.fb.group({username:["adodsworth",{validators:[r.Validators.required]}],password:["testpass",{validators:[r.Validators.required]}]})},e.prototype.doLogin=function(){this.loginFormSubmitted=!0,this.loginForm.invalid||this.login.emit(this.loginForm.value)},e.prototype.doClear=function(){this.loginForm.reset(),this.clear.emit()},e}();j.ɵfac=function(e){return new(e||j)(n.ɵɵdirectiveInject(r.FormBuilder))},j.ɵcmp=n.ɵɵdefineComponent({type:j,selectors:[["app-login-form"]],outputs:{login:"login",clear:"clear"},decls:19,vars:4,consts:[["class","validation-summary-card",4,"ngIf"],[1,"login-form",3,"formGroup","submit"],[1,"form-field"],["appearance","outline"],["matInput","","formControlName","username"],[4,"ngIf"],["matInput","","formControlName","password"],[1,"buttons"],["type","submit","mat-raised-button","","color","primary"],["type","reset","mat-raised-button","",3,"click"],[1,"validation-summary-card"],[1,"validation-summary-header"],[1,"validation-summary-title"],["role","list","dense",""],["role","listitem",4,"ngIf"],["role","listitem"],["mat-list-icon",""]],template:function(e,t){1&e&&(n.ɵɵtemplate(0,T,8,2,"mat-card",0),n.ɵɵelementStart(1,"form",1),n.ɵɵlistener("submit",(function(){return t.doLogin()})),n.ɵɵelementStart(2,"div",2),n.ɵɵelementStart(3,"mat-form-field",3),n.ɵɵelementStart(4,"mat-label"),n.ɵɵtext(5,"Username"),n.ɵɵelementEnd(),n.ɵɵelement(6,"input",4),n.ɵɵtemplate(7,_,2,0,"mat-error",5),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(8,"div",2),n.ɵɵelementStart(9,"mat-form-field",3),n.ɵɵelementStart(10,"mat-label"),n.ɵɵtext(11,"Password"),n.ɵɵelementEnd(),n.ɵɵelement(12,"input",6),n.ɵɵtemplate(13,O,2,0,"mat-error",5),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementStart(14,"div",7),n.ɵɵelementStart(15,"button",8),n.ɵɵtext(16,"Login"),n.ɵɵelementEnd(),n.ɵɵelementStart(17,"button",9),n.ɵɵlistener("click",(function(){return t.doClear()})),n.ɵɵtext(18,"Clear"),n.ɵɵelementEnd(),n.ɵɵelementEnd(),n.ɵɵelementEnd()),2&e&&(n.ɵɵproperty("ngIf",t.showLoginFormValidationSummary),n.ɵɵadvance(1),n.ɵɵproperty("formGroup",t.loginForm),n.ɵɵadvance(6),n.ɵɵproperty("ngIf",t.showUsernameError),n.ɵɵadvance(6),n.ɵɵproperty("ngIf",t.showPasswordError))},directives:[t.NgIf,r.ɵangular_packages_forms_forms_y,r.NgControlStatusGroup,r.FormGroupDirective,c.MatFormField,c.MatLabel,d.MatInput,r.DefaultValueAccessor,r.NgControlStatus,r.FormControlName,m.MatButton,u.MatCard,u.MatCardHeader,u.MatCardTitle,u.MatCardContent,a.MatList,a.MatListItem,s.MatIcon,a.MatListIconCssMatStyler,c.MatError],styles:[".buttons[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]{padding:6px 0;text-align:center}.buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin:4px}.validation-summary-card[_ngcontent-%COMP%]{margin:0 auto 20px;max-width:400px;padding:0}.validation-summary-header[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff}.validation-summary-title[_ngcontent-%COMP%]{font-size:1.1rem;margin:0;padding:12px}.mat-card-content[_ngcontent-%COMP%]{padding:8px 0}.mat-list-base[dense][_ngcontent-%COMP%]   .mat-list-item.mat-list-item-with-avatar[_ngcontent-%COMP%], .mat-list-base[dense][_ngcontent-%COMP%]   .mat-list-option.mat-list-item-with-avatar[_ngcontent-%COMP%]{height:32px}.mat-list-base[dense][_ngcontent-%COMP%]   .mat-list-item[_ngcontent-%COMP%]{font-size:.9rem}"]});var U=function(){function e(){this.userProfile=null}return e.prototype.ngOnInit=function(){},e}();U.ɵfac=function(e){return new(e||U)},U.ɵcmp=n.ɵɵdefineComponent({type:U,selectors:[["app-user-profile"]],inputs:{userProfile:"userProfile"},decls:7,vars:3,template:function(e,t){1&e&&(n.ɵɵelementStart(0,"div"),n.ɵɵelementStart(1,"div"),n.ɵɵtext(2),n.ɵɵelementEnd(),n.ɵɵelementStart(3,"div"),n.ɵɵtext(4),n.ɵɵelementEnd(),n.ɵɵelementStart(5,"div"),n.ɵɵtext(6),n.ɵɵelementEnd(),n.ɵɵelementEnd()),2&e&&(n.ɵɵadvance(2),n.ɵɵtextInterpolate1("Username: ",null==t.userProfile?null:t.userProfile.username,""),n.ɵɵadvance(2),n.ɵɵtextInterpolate1("Display Name: ",null==t.userProfile?null:t.userProfile.displayName,""),n.ɵɵadvance(2),n.ɵɵtextInterpolate1("Roles: ",null==t.userProfile||null==t.userProfile.roles?null:t.userProfile.roles.join(", "),""))},styles:[""]});var q=function(){};q.ɵmod=n.ɵɵdefineNgModule({type:q}),q.ɵinj=n.ɵɵdefineInjector({factory:function(e){return new(e||q)},imports:[[t.CommonModule,r.ReactiveFormsModule,o.HttpClientModule,a.MatListModule,i.MatToolbarModule,l.MatSidenavModule,m.MatButtonModule,s.MatIconModule,u.MatCardModule,c.MatFormFieldModule,d.MatInputModule,p.MatMenuModule,f.MatTableModule,g.MatSnackBarModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.ɵɵsetNgModuleScope(q,{declarations:[S,I,j,U],imports:[t.CommonModule,r.ReactiveFormsModule,o.HttpClientModule,a.MatListModule,i.MatToolbarModule,l.MatSidenavModule,m.MatButtonModule,s.MatIconModule,u.MatCardModule,c.MatFormFieldModule,d.MatInputModule,p.MatMenuModule,f.MatTableModule,g.MatSnackBarModule],exports:[S,I,j,U]});var N=function(){function e(e,t){this.usersSvc=e,this.snackBar=t}return e.prototype.canActivate=function(e,t){var n;if(null===(n=this.usersSvc.getCurrentUser())||void 0===n?void 0:n.hasRole(e.data.roles))return!0;var r=this.snackBar.open("You are not allowed to navigate to the "+e.data.title+".","Dismiss");return r.onAction().subscribe((function(){r.dismiss()})),!1},e}();N.ɵfac=function(e){return new(e||N)(n.ɵɵinject(P),n.ɵɵinject(g.MatSnackBar))},N.ɵprov=n.ɵɵdefineInjectable({token:N,factory:N.ɵfac,providedIn:"root"});var L=function(){function e(e){this.usersSvc=e}return e.prototype.withAccessToken=function(e){return e.clone({headers:e.headers.set("Authorization","Bearer "+this.usersSvc.getAccessToken())})},e.prototype.withRefreshToken=function(e){return e.clone({method:"GET",headers:e.headers.set("Authorization","Bearer "+this.usersSvc.getRefreshToken())})},e.prototype.intercept=function(e,t){var n=this;return e.url.endsWith("/api/users/login")?t.handle(e):e.url.endsWith("/api/users/refresh")?t.handle(this.withRefreshToken(e)):t.handle(this.withAccessToken(e)).pipe(w.catchError((function(r,a){return r instanceof o.HttpErrorResponse?401===r.status?n.usersSvc.refreshUser().pipe(w.switchMap((function(){return t.handle(n.withAccessToken(e))}))):M.throwError(r):a})))},e}();L.ɵfac=function(e){return new(e||L)(n.ɵɵinject(P))},L.ɵprov=n.ɵɵdefineInjectable({token:L,factory:L.ɵfac,providedIn:"root"});var B=function(){function e(e,t){this.usersSvc=e,this.router=t}return e.prototype.canActivate=function(e,t){return!!this.usersSvc.getCurrentUser()||this.router.parseUrl("/login")},e}();B.ɵfac=function(e){return new(e||B)(n.ɵɵinject(P),n.ɵɵinject(v.Router))},B.ɵprov=n.ɵɵdefineInjectable({token:B,factory:B.ɵfac,providedIn:"root"}),e.AllowedRolesGuardService=N,e.AuthorizationInterceptorService=L,e.ChangePasswordFormComponent=S,e.CurrentUser=C,e.CurrentUserComponent=I,e.LoggedInGuardService=B,e.LoginFormComponent=j,e.UserLibModule=q,e.UserProfileComponent=U,e.UsersService=P,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=user-lib.umd.min.js.map